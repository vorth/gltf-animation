<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/x_ite@latest/dist/x_ite.js"></script>
    <style>
body {
  background-color: rgb(228, 237, 255);
  color: rgb(28, 40, 59);
  font-family: Verdana, Geneva, Tahoma, sans-serif;
  max-width: 750px;
  margin: auto;
}

a {
  color: rgb(106, 140, 191);
}

x3d-canvas {
  width: 768px;
  height: 432px;
}
    </style>
    <style>
      /* Viewer */
      @media (prefers-color-scheme: dark) {

        html:not([data-mode]),
        html[data-mode=dark] {
          --list-color: rgba(0, 0, 0, 0.1);
        }

        html[data-mode=light] {
          --list-color: rgba(0, 0, 0, 0.02);
        }
      }

      @media (prefers-color-scheme: light) {
        html[data-mode=dark] {
          --list-color: rgba(0, 0, 0, 0.1);
        }

        html:not([data-mode]),
        html[data-mode=light] {
          --list-color: rgba(0, 0, 0, 0.02);
        }
      }

      .viewer-row {
        display: flex;
        height: calc(100vh - 128px);
      }

      .viewer-column1 {
        position: relative;
        flex: 80%;
        /* width: 80%; */
        height: 100%;
      }

      .viewer-column2 {
        flex: 20%;
        width: 20%;
        height: 100%;
        overflow-y: scroll;
        background-color: var(--list-color);
        padding: 1rem;
      }

      x3d-canvas {
        display: block;
        width: 100%;
        height: 100%;
        aspect-ratio: unset;
      }

      #options {
        -ms-user-select: none;
        /* IE 10 and IE 11 */
        -webkit-user-select: none;
        /* Safari */
        user-select: none;
        position: absolute;
        right: 5px;
        bottom: 5px;
        min-width: 200px;
        padding: 10px 20px;
        background-color: var(--main-bg);
        border: 1px solid var(--nav-border-color);
        border-radius: 0.8rem;
      }

      #options b {
        display: block;
        -ms-user-select: auto;
        /* IE 10 and IE 11 */
        -webkit-user-select: auto;
        /* Safari */
        user-select: auto;
      }

      #options button {
        display: block;
      }

      #scenes,
      #animations {
        display: block;
      }
    </style>

    <script type="module" >
class AnimationViewer
{
   static run (browser)
   {
      this .viewer = new AnimationViewer( browser );
   }

   constructor (browser)
   {
      browser .setBrowserOption( "ColorSpace", "LINEAR" );

      this .browser      = browser;

      setTimeout (() => {
         this .loadURL( './simple-torus-animation.glb' );
      }, 0);
   }

   get scene ()
   {
      return this .browser .currentScene;
   }

   async loadURL (filename)
   {
      // document .querySelector ( "#animations" ) .style .display = "none";

      await this .browser .loadURL (new X3D .MFString (filename));

      this .viewAll ();
      // this .setEnvironmentLight (!no_ibl .some (name => filename .includes (name)));
      // this .setHeadlight (!no_headlight .some (name => filename .includes (name)));
      // this .setToneMapping (this .localStorage .toneMapping);
      // this .setBackground (this .localStorage .background);
      // this .addScenes ();
      // this .addViewpoints ();
      // this .addMaterialVariants ();
      this .addAnimations ();
   }

   async viewAll ()
   {
      await this .browser .nextFrame ();

      if (!this .browser .activeViewpoint ?.description)
         this .browser .viewAll (0);
   }

   addAnimations ()
   {
      const animations = this .scene .getExportedNode ("Animations");

      if (!animations)
         return;

      const animationsElem = document .querySelector ( "#animations" );

      for (const [i, group] of animations .children .entries ())
      {
         const timeSensor = group .children [0];

         const onclick = () =>
         {
            // group .toggleClass (["fa-circle", "fa-circle-dot", "selected"]);
            // group .toggleClass ("selected");

            for (const kids of animations .children)
               kids .children [0] .stopTime = Date .now () / 1000;

            // if (!group .hasClass ( "fa-circle-dot"))
            //    return;

            // $("#animations i") .each ((_, element) =>
            // {
            //    if (element === $(`#animation${i}`) .get (0))
            //       return;

            //    $(element) .removeClass (["fa-circle-dot", "selected"]) .addClass ("fa-circle");
            //    $(`[for=${$(element) .attr ("id")}]`) .removeClass ("selected");
            // });

            timeSensor .loop      = false;
            timeSensor .startTime = Date .now () / 1000;
         };

         const button = document .createElement ("button");
         button .classList .add ("check");
         button .setAttribute ("for", `animation${i}`);
         button .textContent = group .children [0] .description;
         button .addEventListener ("click", onclick);
         animationsElem .appendChild (button);

         const icon = document .createElement ("i");
         icon .classList .add ("fa-regular", "fa-circle");
         icon .setAttribute ("id", `animation${i}`);
         button .prepend (icon);
      }

      // $("#animations") .show () .find ("button") .first () .trigger ("click");
   }

}

AnimationViewer .run( X3D .getBrowser() );

    </script>
  </head>
  <body>
    <h1>glTF Animation Viewer</h1>

    <div class="viewer viewer-row">
      <div class="viewer-column1">
        <x3d-canvas class="xr-button-tr" debug="true" contentScale="auto"
          update="auto" toneMapping="KHR_PBR_NEUTRAL">
        </x3d-canvas>
        <div id="options">
          <!-- <div id="scenes"></div>
          <div id="viewpoints"></div>
          <div id="material-variants"></div> -->
          <div id="animations">
            <b>Animations</b>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>